<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HONEYBITES BAKERY SDN BHD - E-Invoice Request</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
  .container { max-width: 800px; margin: 40px auto; padding: 30px; background: #f9fbfc; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
  h1,h2 { text-align: center; }
  h2 { margin-top: 40px; margin-bottom: 20px; color: #333; }
  label { font-weight: 600; display: block; margin-top: 15px; }
  input[type="text"], input[type="email"], textarea, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
  textarea { resize: none; height: 60px; }
  textarea::placeholder, input::placeholder { color: #888; font-style: italic; }
  .optional { font-weight: normal; font-size: 13px; color: #555; }
  .status-box { padding: 15px; border-radius: 8px; margin-top: 20px; display:none; }
  .status-blue { background: #d0e7ff; color: #0d4f91; }
  .status-green { background: #d4f4d7; color: #1a7f2e; }
  .status-red { background: #fdd; color: #a00; }
  .special-msg { background: #ffe0e0; color: #a00; padding: 15px; border-radius: 8px; margin-bottom: 20px; display:none; }
  .flex { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .half-width { flex: 1; }

  /* Centered, long submit button */
  #invoiceForm button[type="submit"] {
    display: block;
    width: 100%;
    max-width: 400px;
    margin: 30px auto 0;
    padding: 12px 20px;
    font-size: 16px;
    font-weight: 600;
    color: #fff;
    background-color: #0d4f91;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  #invoiceForm button[type="submit"]:hover {
    background-color: #09356a;
  }
</style>
</head>
<body>
<div class="container">
  <img src="https://i.imgur.com/0lppOV5.png" alt="Logo" style="display:block; margin:0 auto 20px; max-width:200px;">
  <h1>HONEYBITES BAKERY SDN BHD</h1>
  <h2>E-Invoice Request Application</h2>

  <div class="special-msg" id="specialMsg">
    ⚠️ Receipt Submitted after 3rd date on new month. Form disabled.
  </div>

  <form id="invoiceForm">
    <!-- Receipt Information -->
    <h2>Receipt Information</h2>
    <label>Date:</label>
    <input type="text" id="date" placeholder="DD/MM/YYYY" readonly>
    <label>Invoice No.:</label>
    <input type="text" id="invoice" placeholder="HBSA-T01-XXXXXX" readonly>
    <label>Amount (RM):</label>
    <input type="text" id="amount" placeholder="RM0.00" readonly>
    <label>Cashier Terminal:</label>
    <select id="terminal" disabled>
      <option value="">Select Terminal</option>
      <option value="T-01">T-01 (Pasar Counter 1)</option>
      <option value="T-02">T-02 (Pasar Counter 2)</option>
      <option value="T-04">T-04 (Lian Yi Counter)</option>
    </select>

    <!-- Buyer Information -->
    <h2>Buyer Information</h2>
    <label>Name: <span style="color:red">*</span></label>
    <input type="text" id="name" placeholder="Enter full name" required oninput="formatUppercase(this)">
    <label>Email: <span style="color:red">*</span></label>
    <input type="email" id="email" placeholder="example@email.com" required oninput="formatLowercaseNoSpace(this)">
    <label>Classification: <span style="color:red">*</span></label>
    <select id="classification" required onchange="toggleSections()">
      <option value="">Select</option>
      <option value="Individual">Individual</option>
      <option value="Business">Business</option>
      <option value="Government">Government</option>
    </select>

    <div id="identitySection" style="display:none;">
      <label>Identity:</label>
      <div class="flex">
        <select id="identityType">
          <option value="">Select Type</option>
          <option value="MyKad">MyKad</option>
          <option value="MyPR">MyPR</option>
          <option value="MyKAS">MyKAS</option>
          <option value="Army">Army</option>
          <option value="Passport">Passport</option>
        </select>
        <input type="text" id="identityNumber" placeholder="Enter ID number" oninput="formatUppercase(this)">
      </div>
    </div>

    <label>TIN: <span style="color:red">*</span></label>
    <div style="display: flex; flex-direction: column; align-items: flex-start; gap:5px;">
      <label><input type="checkbox" name="tin" value="EI00000000010" onclick="toggleTIN(this)"> EI00000000010 (Malaysian Citizen)</label>
      <label><input type="checkbox" name="tin" value="EI00000000020" onclick="toggleTIN(this)"> EI00000000020 (Non-Malaysian)</label>
      <label><input type="checkbox" name="tin" value="EI00000000040" onclick="toggleTIN(this)"> EI00000000040 (Government)</label>
    </div>
    <textarea id="tinOther" placeholder="Enter other TIN if not listed" oninput="formatUppercase(this)"></textarea>

    <div id="brnSection" style="display:none;">
      <label>Business Registration Number (BRN):</label>
      <input type="text" id="brn" placeholder="Enter BRN" oninput="formatUppercase(this)">
    </div>

    <div id="sstSection" style="display:none;">
      <label>SST Registration Number: <span class="optional">(put N/A if not applicable)</span></label>
      <input type="text" id="sst" placeholder="Enter SST Number or N/A" oninput="formatUppercaseNoSpace(this)">
    </div>

    <label>Contact Number: <span style="color:red">*</span></label>
    <input type="text" id="contact" placeholder="e.g. 0123456789" oninput="formatNumberOnly(this)" required>

    <label>Address: <span style="color:red">*</span></label>
    <textarea id="address1" placeholder="Address line 1" oninput="formatUppercase(this)" required></textarea>
    <textarea id="address2" class="optional" placeholder="Address line 2 (optional)" oninput="formatUppercase(this)"></textarea>
    <textarea id="address3" class="optional" placeholder="Address line 3 (optional)" oninput="formatUppercase(this)"></textarea>

    <label>Postcode: <span style="color:red">*</span></label>
    <input type="text" id="postcode" placeholder="Enter postcode" oninput="formatNumberOnly(this)" required>
    <label>City: <span style="color:red">*</span></label>
    <input type="text" id="city" placeholder="Enter city" oninput="formatUppercase(this)" required>

    <label>State: <span style="color:red">*</span></label>
    <select id="stateDropdown">
      <option value="">Select State</option>
      <option value="Johor">Johor</option>
      <option value="Kedah">Kedah</option>
      <option value="Kelantan">Kelantan</option>
      <option value="Melaka">Melaka</option>
      <option value="Negeri Sembilan">Negeri Sembilan</option>
      <option value="Pahang">Pahang</option>
      <option value="Perak">Perak</option>
      <option value="Perlis">Perlis</option>
      <option value="Penang">Penang</option>
      <option value="Sabah">Sabah</option>
      <option value="Sarawak">Sarawak</option>
      <option value="Selangor">Selangor</option>
      <option value="Terengganu">Terengganu</option>
      <option value="Kuala Lumpur">Kuala Lumpur</option>
      <option value="Labuan">Labuan</option>
      <option value="Putrajaya">Putrajaya</option>
    </select>
    <input type="text" id="stateText" placeholder="Enter state" style="display:none;" oninput="formatUppercase(this)">

    <label>Country: <span style="color:red">*</span></label>
    <select id="country" required onchange="toggleStateInput()">
      <option value="Malaysia">Malaysia</option>
      <option value="Other">Other</option>
    </select>

    <div style="margin-top:20px;">
      <label><input type="checkbox" id="clarification"> I confirm the above information is correct</label>
    </div>

    <button type="submit">Submit</button>
  </form>

  <div class="status-box" id="statusBox"></div>
</div>

<script>
function formatUppercase(el){ el.value = el.value.replace(/\s+/g,' ').toUpperCase(); }
function formatLowercaseNoSpace(el){ el.value = el.value.replace(/\s+/g,'').toLowerCase(); }
function formatUppercaseNoSpace(el){ el.value = el.value.replace(/\s+/g,'').toUpperCase(); }
function formatNumberOnly(el){ el.value = el.value.replace(/[^0-9\+\-]/g,''); }

// ---------------- Toggle Sections ----------------
function toggleSections(){
  const cls = document.getElementById('classification').value;
  document.getElementById('identitySection').style.display = cls === 'Individual' ? 'block' : 'none';
  document.getElementById('brnSection').style.display = cls === 'Business' ? 'block' : 'none';
  document.getElementById('sstSection').style.display = cls === 'Business' ? 'block' : 'none';
}

// ---------------- TIN Single-Select ----------------
function toggleTIN(el){
  const checkboxes = document.getElementsByName('tin');
  checkboxes.forEach(cb => {
    if(cb !== el) cb.checked = false;  // Uncheck all others
  });
  document.getElementById('tinOther').disabled = el.checked;  // Disable "other TIN" if any selected
}

// ---------------- State / Country Toggle ----------------
function toggleStateInput(){
  const country = document.getElementById('country').value;
  const dropdown = document.getElementById('stateDropdown');
  const textBox = document.getElementById('stateText');

  if(country === 'Malaysia'){
    dropdown.style.display = 'block';
    dropdown.required = true;
    textBox.style.display = 'none';
    textBox.required = false;
  } else {
    dropdown.style.display = 'none';
    dropdown.required = false;
    textBox.style.display = 'block';
    textBox.required = true;
  }
}

// ---------------- Prefill Fields from URL ----------------
function getQueryParams(){
  const params = {};
  location.search.substr(1).split("&").forEach(function(item){
    let [key,val] = item.split("=");
    params[key] = decodeURIComponent(val || '');
  });
  return params;
}

function prefillFields(){
  const params = getQueryParams();
  
  if(params.date) document.getElementById('date').value = params.date;
  if(params.receipt) document.getElementById('invoice').value = params.receipt;
  if(params.total) document.getElementById('amount').value = params.total.startsWith('RM') ? params.total : 'RM'+params.total;

  const receipt = params.receipt || '';
  if(receipt.includes('T01')) document.getElementById('terminal').value = 'T-01';
  else if(receipt.includes('T02')) document.getElementById('terminal').value = 'T-02';
  else if(receipt.includes('T04')) document.getElementById('terminal').value = 'T-04';

  // Country prefill and state toggle
  if(params.country){
    document.getElementById('country').value = params.country;
    toggleStateInput();
  }

  // Special message for receipt submitted after 3rd of next month
  if(params.date){
    const [dd, mm, yyyy] = params.date.split('/');
    const receiptDate = new Date(`${yyyy}-${mm}-${dd}`);
    const today = new Date();
    if(today.getFullYear() > receiptDate.getFullYear() || 
       (today.getFullYear() === receiptDate.getFullYear() && today.getMonth() > receiptDate.getMonth() && today.getDate() > 3)){
      document.getElementById('specialMsg').style.display='block';
      document.getElementById('invoiceForm').querySelectorAll('input, select, textarea, button').forEach(el => el.disabled = true);
    }
  }
}

// ---------------- Form Submission ----------------
document.getElementById('invoiceForm').addEventListener('submit', function(e){
  e.preventDefault();
  const status = document.getElementById('statusBox');
  status.style.display = 'block';
  status.className='status-box status-blue';
  status.innerText='Submitting...';

  const data = Object.fromEntries(new FormData(this).entries());
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxsIHd1Tz3I91Xr0OHM4u_MJrVZB2Pypv0Ze3HvPoL6eJZeW_wahRlzGInsMt4kyT4B/exec'; // <-- Replace with your deployed Web App URL

  fetch(SCRIPT_URL, { 
    method: 'POST', 
    body: JSON.stringify(data), 
    headers:{'Content-Type':'application/json'} 
  })
  .then(resp => resp.json()) // parse JSON
  .then(json => {
    if(json.status === 'success'){
      status.className='status-box status-green';
      status.innerText='Submitted Successfully';
      this.reset();
    } else {
      status.className='status-box status-red';
      status.innerText='Failed to Submit: ' + (json.message || '');
    }
  })
  .catch(err => {
    status.className='status-box status-red';
    status.innerText='Failed to Submit: ' + err.message;
  });
});

// ---------------- Initialize on Load ----------------
window.onload = prefillFields;
</script>
</body>
</html>



